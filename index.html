<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writebox | Focused Writing</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=Fira+Code&family=Inter:wght@300;400;600&family=JetBrains+Mono&family=Libre+Baskerville&family=Lora:ital,wght@0,400;0,500;1,400&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Theme: Ivory (Default) */
            --bg: #fdfcfb;
            --paper: #fdfcfb;
            --text: #2c2c2c;
            --accent: #8e8e8e;
            --ui-bg: rgba(255, 255, 255, 0.8);
            --border: rgba(0,0,0,0.05);
            --selection: #e2e2e2;
            --font-main: 'Crimson Pro', serif;
        }

        body.dark-theme {
            --bg: #121212;
            --paper: #121212;
            --text: #d1d1d1;
            --accent: #666;
            --ui-bg: rgba(30, 30, 30, 0.8);
            --border: rgba(255,255,255,0.05);
            --selection: #333;
        }

        body.nord-theme {
            --bg: #2e3440;
            --paper: #2e3440;
            --text: #d8dee9;
            --accent: #81a1c1;
            --ui-bg: rgba(59, 66, 82, 0.9);
            --border: rgba(255,255,255,0.05);
            --selection: #434c5e;
        }

        body.sepia-theme {
            --bg: #f4ecd8;
            --paper: #f4ecd8;
            --text: #433422;
            --accent: #a69279;
            --ui-bg: rgba(235, 225, 200, 0.9);
            --border: rgba(0,0,0,0.06);
            --selection: #eaddbd;
        }

        * { box-sizing: border-box; transition: background 0.4s ease, color 0.4s ease; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            overflow-x: hidden;
            display: flex;
            justify-content: center;
        }

        /* The Writing Canvas */
        .editor-wrapper {
            width: 100%;
            max-width: 720px; /* Optimized for reading/writing speed */
            padding: 15vh 40px 40vh 40px;
            min-height: 100vh;
        }

        #editor {
            width: 100%;
            min-height: 50vh;
            outline: none;
            font-size: 21px;
            line-height: 1.8;
            letter-spacing: 0.01em;
            white-space: pre-wrap;
            word-wrap: break-word;
            caret-color: var(--accent);
        }

        #editor::selection { background: var(--selection); }

        /* Minimalist Navigation */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 1;
            transition: opacity 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            background: var(--ui-bg);
        }

        .brand {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
        }

        /* Floating Toolbar */
        .toolbar {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 10px 25px;
            background: var(--ui-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border);
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            opacity: 1;
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            z-index: 1000;
        }

        .tool-group { display: flex; align-items: center; gap: 12px; }

        .btn-icon {
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            padding: 5px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            opacity: 0.6;
            transition: 0.2s;
        }
        .btn-icon:hover { opacity: 1; background: var(--selection); }

        select {
            background: none;
            border: none;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            cursor: pointer;
            outline: none;
            opacity: 0.7;
            padding: 6px 12px;
            border-radius: 6px;
            appearance: none;
            background: var(--selection);
        }

        .stats {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            letter-spacing: 0.5px;
            color: var(--accent);
            text-transform: uppercase;
            white-space: nowrap;
        }

        .theme-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
        }
        .theme-dot.active { border-color: var(--accent); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        @media (max-width: 768px) {
            .editor-wrapper { padding: 10vh 25px 30vh 25px; }
            #editor { font-size: 19px; }
            .toolbar { width: 90%; flex-wrap: wrap; justify-content: center; border-radius: 20px; }
            .header { padding: 15px 20px; }
        }
    </style>
</head>
<body class="ivory-theme">

    <header class="header">
        <div class="brand">Writebox Studio</div>
        <div class="stats">
            <span id="wordCount">0 words</span> &nbsp;â€¢&nbsp; 
            <span id="readTime">0 min read</span>
        </div>
    </header>

    <main class="editor-wrapper">
        <div id="editor" contenteditable="true" spellcheck="true" autofocus></div>
    </main>

    <div class="toolbar">
        <div class="tool-group">
            <select id="fontFamily">
                <option value="'Crimson Pro', serif">Crimson Pro</option>
                <option value="'Lora', serif">Lora</option>
                <option value="'Libre Baskerville', serif">Baskerville</option>
                <option value="'Playfair Display', serif">Playfair</option>
                <option value="'Inter', sans-serif">Modern Sans</option>
                <option value="'JetBrains Mono', monospace">Mono</option>
            </select>
        </div>

        <div class="tool-group">
            <button class="btn-icon" id="copyBtn" title="Copy to Clipboard">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            </button>
            <button class="btn-icon" id="downloadBtn" title="Download as TXT">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </button>
        </div>

        <div class="tool-group">
            <div class="theme-dot" style="background: #fdfcfb; border: 1px solid #ddd;" data-theme="ivory-theme"></div>
            <div class="theme-dot" style="background: #f4ecd8;" data-theme="sepia-theme"></div>
            <div class="theme-dot" style="background: #2e3440;" data-theme="nord-theme"></div>
            <div class="theme-dot" style="background: #121212;" data-theme="dark-theme"></div>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const wordCount = document.getElementById('wordCount');
        const readTime = document.getElementById('readTime');
        const fontFamily = document.getElementById('fontFamily');
        
        // --- Persistence ---
        const storage = {
            save: () => {
                localStorage.setItem('writebox_content', editor.innerHTML);
                localStorage.setItem('writebox_font', fontFamily.value);
                localStorage.setItem('writebox_theme', document.body.className);
            },
            load: () => {
                const content = localStorage.getItem('writebox_content');
                if (content) editor.innerHTML = content;
                
                const font = localStorage.getItem('writebox_font');
                if (font) {
                    fontFamily.value = font;
                    editor.style.fontFamily = font;
                }

                const theme = localStorage.getItem('writebox_theme');
                if (theme) document.body.className = theme;
                
                updateStats();
            }
        };

        // --- Core Functions ---
        function updateStats() {
            const text = editor.innerText.trim();
            const words = text ? text.split(/\s+/).length : 0;
            const minutes = Math.ceil(words / 200);
            
            wordCount.innerText = `${words} words`;
            readTime.innerText = `${minutes} min read`;
        }

        function typewriterScroll() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();
                const center = window.innerHeight / 2;

                if (rect.top > center) {
                    window.scrollBy({ top: rect.top - center, behavior: 'smooth' });
                }
            }
        }

        // --- Event Listeners ---
        editor.addEventListener('input', () => {
            updateStats();
            storage.save();
            typewriterScroll();
        });

        fontFamily.addEventListener('change', (e) => {
            editor.style.fontFamily = e.target.value;
            storage.save();
        });

        document.querySelectorAll('.theme-dot').forEach(dot => {
            dot.addEventListener('click', () => {
                document.body.className = dot.dataset.theme;
                storage.save();
            });
        });

        document.getElementById('copyBtn').addEventListener('click', () => {
            const text = editor.innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.style.color = '#4CAF50';
                setTimeout(() => btn.style.color = 'inherit', 2000);
            });
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const text = editor.innerText;
            const blob = new Blob([text], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = `story-${new Date().toLocaleDateString()}.txt`;
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
        });

        // Initialize
        window.addEventListener('load', storage.load);

        // Subtle Focus: Re-focus editor if clicking empty area
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'MAIN') editor.focus();
        });
    </script>
</body>
</html>
